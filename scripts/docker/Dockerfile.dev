# Development Dockerfile for Koala Blog
ARG NODE_VERSION=20

FROM node:${NODE_VERSION}-alpine AS development

# Install system dependencies
RUN apk add --no-cache \
    sqlite \
    git \
    && corepack enable \
    && corepack prepare pnpm@10.14.0 --activate

# Create app directory
WORKDIR /app

# Copy package files
COPY package.json pnpm-lock.yaml ./
COPY .npmrc ./

# Install dependencies
RUN pnpm install --frozen-lockfile

# Set environment variables
ENV NODE_ENV=development
ENV DATA_SOURCE=sqlite
ENV DEPLOY_MODE=standalone
ENV HOST=0.0.0.0
ENV PORT=4321

# Expose port
EXPOSE 4321

# Default command (can be overridden in docker-compose)
CMD ["pnpm", "run", "dev:sqlite"]