---
import ArticlePage from '@/components/article-view/ArticlePage.astro'
import { MarkdownSource } from '@/db'
import { readArticle } from '@/lib/services/article'

const { link } = Astro.params

if (!link) {
  return Astro.redirect(`/404?source=${encodeURIComponent(Astro.url.pathname)}`)
}

const source = MarkdownSource.Post
const article = await readArticle(Astro, source, link)

if (article instanceof Response) {
  return article
}
---
<ArticlePage article={article} />
