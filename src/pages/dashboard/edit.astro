---
import Page from '@/components/editor/Page.svelte'
import { justReadAll } from '@/db/markdown'
import { initMarkdown } from '@/db/types'
import DashboardLayout from '@/layouts/dashboard.astro'

const url = Astro.url
const id = Number(url.searchParams.get('id') || '0')
const link = url.searchParams.get('link')

let article = initMarkdown()

let initialItems: Awaited<ReturnType<typeof justReadAll>> = []
initialItems = await justReadAll(Astro.locals.runtime?.env)

if (id) {
  const found = initialItems.find(i => i.id === id)
  if (found) {
    article = found
  }
}
else if (link) {
  const found = initialItems.find(i => i.link === link)
  if (found) {
    article = found
  }
}
---

<DashboardLayout title={`[Editor] ${article.subject}`} showHeader={false}>
  <Page client:load initialMarkdown={article} initialItems={initialItems} />
</DashboardLayout>
